# 第一章： 安全入门

### 什么是安全 （一个看似简单的问题，但是要回答他又很复杂。）

如果不去了解安全是什么， 当我们出现在安全问题时， 我们很难理解或者甚至不知道要做些什么。你经常在新闻中看到成功黑客有无限的选择余地来制造他们高度复杂的攻击。当这样想的时候，安全感觉就像一个几乎无法理解的可能无法战胜的领域。

无论我们的背景如何，重要的是我们在开始之前都要了解一些关键的安全原则。我们还将研究传统上接近安全性的方式，以及为什么这种方法不再像以前那样有效当敏捷变得越来越普遍。

开发团队的安全性往往侧重于信息安全。信息安全性在项目开始期间，系统实施期间以及通过系统的运行期间。 我们讨论的安全主要也是讨论的信息安全。

### 安全是不是一个技术问题

作为工程师，我们经常讨论我们系统及其环境的技术选择。 安全迫使我们扩展技术。 安全性可能最好被认为是技术与日常互动的人之间的重叠，如图所示

![aasc_0101.png](./img/aasc_0101.png)

这个图它可以简单地看作是一种说明，安全不仅仅是技术，而且在其定义中，必须包括人

为什么这说， 人们从一开始就不需要技术来做坏事， 这些活动早在计算机出现之前已经有了。人们已经进化了几千年来撒谎，欺骗和窃取物品以进一步促进自己和组织。然而，当人们开始与技术互动时，这将成为动机，目标和机会的有力组合, 来促使他们进行犯罪。互联网和相关技术使这个世界变得更小，并且这样做使得不对称性更加严峻 - 成本下降，回报增加，被抓获的可能性大幅减少。

随着社会越来越依赖技术，对安全的需求和缺席的影响显着增加。随着技术越来越多地出现在社会结构中，思考其安全性的方法变得越来越重要。传统信息安全方法的一个根本缺点是没有认识到人们和技术一样重要。这是我们希望在本书中提供新视角的领域。

### 安全不仅仅是极客的问题

有一段时间，安全是政府和极客的独家担忧。 现在，随着互联网成为全世界人们生活中不可或缺的一部分， 确保其背后的技术与社会的大部分相关。如果您使用技术，安全就很重要，因为安全性失败会直接伤害您和您的社区。

如果您构建技术，您的首要目标是保持其稳定和安全的，这样我们就可以在其基础之上改善我们的业务和社会。 安全不再是精神上可以外包的领域：
 - 您有责任考虑该技术的安全性。
 - 您为人们提供日常生活中的安全保障。

不承担这一责任意味着您构建的技术将在根本上存在缺陷，并且在其主要功能之一中是失败的。

### 安全是关于风险

安全性或更具体地保护软件是关于最小化风险 我们试图降低我们的人员，系统和数据的使用可能性，从而导致财务或人身伤害，或损害我们组织的声誉。

要计算风险，您需要了解组织和系统可能发生的事情，发生的可能性以及发生的成本。 这使您可以计算出花费多少钱和精力来防范这些东西。

在系统和安全意义上，我们使用漏洞这个词来描述系统，组件或过程中的任何缺陷，这些缺陷将允许我们的数据，系统或人员以某种方式被滥用，暴露或损害。

可能性是我们衡量攻击者能够（并且有动力）利用漏洞的容易程度（或可能性）的方式。

#### 评估要点
- 利用此漏洞所需的技术技能。 您是否需要成为一名技术专家，或者获得高水平的知识是否足够？

- 可靠性。 漏洞利用是否可靠？在可能发现漏洞的不同版本，平台和体系结构上怎么办？攻击越可靠，攻击引起副作用的可能性就越小：这使攻击者可以使用更安全的攻击，因为它可以降低检测的可能性。

- 自动化。 利用漏洞是否适合自动化？这有助于将其包含在漏洞利用工具包或自我传播代码（蠕虫）之类的内容中，这意味着您更有可能受到不加区分的漏洞利用尝试。

- 访问。 您是否需要能够直接与网络上的特定系统通信或具有一组特定的用户权限？ 您是否需要已经破坏系统的一个或多个其他部分才能利用此漏洞？
- 动机。 利用此漏洞的最终结果是否足以激励某人花时间？

风险可以最小化，而不是避免。由于我们不控制风险或其原因，我们永远无法完全避免它。试图这样做是不可能的，也是徒劳的。相反，我们必须专注于了解我们的风险，尽可能减少风险（及其影响），并在我们的领域内保持对新的不断变化或新兴风险的监控。

### 了解你的敌人，安全价值 保护我们的数据, 系统和人员

- 了解你要保护的对象
- 机密性，完整性和可用性
  - 机密性 现在很少有系统允许所有人做所有事情。 我们将应用程序用户分为角色和职责。 我们希望确保只有那些我们可以信任，经过身份验证并被授权采取行动的人才能访问我们的数据并与之互动。
  - 完整性 从赋予我们数据的那一刻起，我们就理解并能够控制修改的方式(谁可以修改，何时可以修改，以及以什么方式修改)。维护数据完整性并不是保持数据保持不变;它是关于让它受到一组可控制和可预测的行动的控制，以便我们理解和保持它的当前状态。
  - 可用性 要求我们保证我们的数据，系统和人员安全，而不妨碍与他们交互。这意味着在我们采取限制访问或保护信息的控制措施与我们作为应用程序的一部分向用户公开的功能之间找到平衡点。 正如我们将要讨论的那样，正是这种平衡为我们的信息共享和始终如一的社会提供了巨大的挑战。

### 常见的安全误区和错误
 - 安全是绝对的
 - 安全是一个可以达到的点
 - 安全是静态的
 - 安全需要特殊（项目/设备/预算）


# 第二章 敏捷启动器

### 主要包含的内容
- 构建管道
- 自动化测试
- 持续集成
- 基础架构代码
- 发布管理 为了减少发布的痛苦和容易出错，敏捷团队尝试更频繁地发布。经常实施和执行的程序往往得到很好的维护和准确
- 可见跟踪
- 集中反馈
- 唯一的好代码是可以部署的代码
- 安全快速的运行

通过标准化和自动化构建管道，您可以为其他实践建立一致的基础。

测试自动化确保每个构建都是正确的。

持续集成自动构建和测试每个更改，以便在开发人员进行更改时提供即时反馈。

持续交付将持续集成扩展到打包和部署，这又要求这些步骤也是标准化和自动化的。

基础架构作为代码应用相同的工程实践和工作流来进行基础架构配置更改。

要关闭反馈循环，您需要在从开发到生产，从生产到开发的所有阶段进行度量和监控。

随着您继续实施和改进这些实践，您的团队将能够更快地移动并且越来越自信。这些实践还提供了一个控制框架，您可以利用该框架来标准化和自动化安全性和合规性，这是我们将在本书的其余部分中探讨的内容。


# 第三章 敏捷革命


### 敏捷的原则
- 我们的首要任务是通过早期和持续交付有价值的软件来满足客户。

- 欢迎不断变化的要求，甚至是开发后期。敏捷流程利用变化来实现客户的竞争优势。

- 经常提供可用的软件，从几周到几个月，优先考虑更短的时间尺度。

- 业务人员和开发人员必须在整个项目中每天一起工作。

- 围绕有动力的个人建立项目。为他们提供所需的环境和支持，并相信他们能够完成工作。

- 向开发团队内部和内部传达信息的最有效和最有效的方法是面对面交谈。

- 高可用的软件是主要衡量标准。

- 敏捷过程促进可持续发展。发起人、开发人员和用户应该能够长期保持稳定的速度。

- 持续关注技术卓越和良好的设计可提高灵活性。

- 简单性 - 最大化未完成工作量的艺术 - 至关重要。

- 最好的架构，要求和设计来自自组织团队。

- 团队定期反思如何变得更有效，然后相应地调整和调整其行为。

### 敏捷的方法
- Scrum最流行的敏捷方法论
    - Sprints and Backlogs
    - Stand-ups
    - Scrum Feedback Loops
- XP编程 是最早的敏捷方法之一
- KANBAN
- 精益开发
    - 精益的一个主要区别是强调分析你所做的事情并从中学习以便迭代。精益作为一种方法，优先考虑构建→测量→学习的原则循环。
- 一般敏捷方法


### DevOps
敏捷团队几乎完全取决于交付的工作软件数量，即开发团队的“速度”。 但是，大多数运营团队都会根据系统稳定性进行评估和奖励。 这可以是正常运行时间或事故的衡量标准。

开发人员通常必须做出与交付时间交换的决策，以及针对长期可操作性问题的交付成本。 如果开发人员不分担运营和支持的责任，这就会产生外部性，奖励短期思维并鼓励开发人员偷工减料。 虽然花些额外的时间来考虑提高可操作性意味可交付的东西变慢，这对开发团队造成了不利影响。

不经常部署的组织倾向于关注平均失效时间（MTBF），这是一种规避风险的策略，但意味着他们在发生故障时更不准备应对故障。相反，我们开始关注的关键指标是运营故障的平均恢复时间（MTTR）。更频繁地发布较小更改的组织可以更快地识别问题的原因，并且能够更好地修复问题，从而降低其MTTR。

### 敏捷与安全

让敏捷团队与安全人员良好合作在历史上一直很困难。部分问题在于，大多数安全流程和实践都是针对大型瀑布项目构建的，其中需要设置需求，而不是针对小型团队快速迭代地工作。

许多安全专业人员很难将他们现有的实践适应这样一个世界，即每隔几周需求就会发生变化，或者根本不会写下来。由团队及时制定设计和风险管理决策的地方，而不是自上而下的计划和指导。而且，手动测试和合规性检查无法跟上交付速度。

更糟糕的是，太多的安全团队使用世界观，其目标是尽可能地抑制变更，以尽量减少应用程序或环境的风险状况变化：如果风险没有变化，那么安全性团队不能因可能出现的新安全问题而受到指责。

试图通过最小化变更来降低风险而不是支持开发团队以安全的方式实现其想法的安全团队注定在敏捷世界中越来越无关紧要，因此将被绕过。结果将是不安全，安全或合规的系统，因为安全性将从开发过程中消除。

尽管如此，有些团队成功地遵循敏捷方法来提供安全软件，本书的其余部分将向您展示可以与敏捷团队和我们认为可以改善整个流程的实践良好协作的技术和工具。

敏捷团队需要了解并选择采用安全实践，并对其系统的安全性承担更多责任。

这些团队的产品所有者需要给团队足够的时间来正确地执行此操作，并且他们需要了解安全性和合规性要求并确定其优先级。

安全专业人员必须学会接受变更，更快，更迭代地工作，并能够以增量方式考虑安全风险以及如何管理风险。最重要的是，安全性需要成为推动者，而不是阻碍者。

敏捷和DevOps不是时尚。 IT的未来将更快，响应更快，更具协作性，更自动化。


# 第四章 使用现有的敏捷生命周期

### 传统的应用安全模型
- 需求评审
- 架构评审
- 代码review
- 安全测试

### 敏捷开发为安全团队带来了新的挑战。成功实施敏捷安全计划的关键是：

参与
敏捷的生命周期中有很多机会可以让安全性和开发人员一起工作，相互学习，互相帮助。在团队中扮演安全角色的人（分配给团队的安全工程师或承担安全责任的开发人员）可以而且应该参与规划会议，站立，回顾和演练。

启用
敏捷团队快速行动，不断学习和改进，安全需求帮助他们不断前进，学习和改进，而不是阻止他们前进。

自动化
安全检查和测试必须以可以轻松，透明地插入开发人员工作流程和构建管道的方式实现自动化。

敏捷性
安全必须敏捷才能跟上敏捷团队的步伐。安全性必须快速，迭代地思考和行动，快速响应，并与开发人员一起不断学习和改进。

# 第五章 安全与需求

所有系统都以要求开始。 安全性也是如此。

### 处理需求中的安全性

敏捷软件从业者认为用户或客户难以准确指定要求，因为语言是一种有损的通信机制，并且因为用户通常所说的他们想要的并不是他们真正想要的

用户能够以某种方式解释他们对软件的需求，但是没有用户会知道她在会话层需要安全令牌以进行CSRF保护 - 用户也不应该知道这种事情。

反对敏捷工作方式的人指出敏捷落下的地方。缺乏前瞻性规划，前期需求定义和设计以及强调快速交付功能可能会使团队在系统中出现重要的非功能性缺口，直到为时已晚，可能无法找到。

根据我们的经验，敏捷并不意味着无计划或不安全。敏捷意味着对改变和改进持开放态度，因此我们认为可以以敏捷方式构建具有内在安全要求的软件

- 敏捷的需求 讲故事
   - 故事内容： As a {type of user} I want to {do something} so that {I can achieve a goal}
   - 满足条件： 对于每个故事，团队与产品负责人合作填写有关功能或更改的详细信息，并编写满意条件或验收标准
- 跟踪和管理故事: 待办事项
- 错误的处理 
是错误的故事吗？ 如何跟踪错误？ 有些团队根本不跟踪错误。 他们立即修复它们，或者根本不修复它们。 有些团队只跟踪他们无法立即修复的错误，将其作为技术债务添加到 待办事项中。

### 获得安全性要求

安全功能的故事（用户/帐户设置，密码更改/忘记密码等）大多是直截了当的：
作为{注册用户}
我想{登录系统}
所以{我只能看到并做我有权查看和做的事情}

安全功能的故事就像任何其他故事一样。但是，由于在实现这些功能时出错的风险，您需要特别注意验收标准，例如以下示例和测试场景：

- 用户成功登录
用户应该看到和做什么？应记录哪些信息以及在哪里？

- 由于凭据无效，用户无法登录
用户应该看到什么错误？用户在访问被禁用之前尝试登录多少次，以及持续多长时间？应记录哪些信息以及在哪里？

- 用户忘记凭据
这应该导致另一个故事，以帮助用户重置密码。

- 用户未注册
这应该导致另一个故事，以帮助用户注册并颁发凭据。

除安全功能外，以下是可能需要考虑的其他安全要求：

- 隐私 识别私有或敏感的信息，并且需要通过加密或标记化，访问控制和审计来保护这些信息。
- 欺诈 身份管理，强制执行职责分离，关键工作流程中的验证和批准步骤，审计和记录，识别行为模式，阈值和异常警报。
- 合规性 合规性要求将限制团队的工作方式，审核或测试需要做什么，以及需要哪些批准或监督，以及团队在开发和交付系统时需要保留所有这些步骤的证据
- 加密 了解需要加密哪些信息， 如何加密：允许的算法和密钥管理技术

### 攻击者故事和攻击树

在需求中包含安全性的另一种方法是通过攻击者故事或滥用案例（而不是用例）。在这些故事中，团队花了一些时间思考一个功能如何被攻击者或其他恶意用户，甚至是粗心用户滥用。这迫使团队思考需要防范的具体行动，如下例所示：

作为{某种对手}
我想{尝试做坏事}
这样{我可以窃取或损坏敏感信息
或者在不付钱的情况下得到一些东西
或禁用系统的关键功能
或者其他一些坏事...}

攻击树 从一个攻击开始列出所有的攻击可能形成一个攻击树

### 本章重点

安全性发生在思想过程和故事设计中，而不仅仅是在编码过程中。及早参与并教育每个人思考安全性。

在编写和阐述用户故事时要注意它们。寻找安全风险和顾虑。

考虑构建攻击树，以帮助您的团队了解攻击者可能攻击您的系统的方式，以及您需要采取哪些保护措施。

为高风险用户故事编写攻击者故事：从对手的角度编写的故事镜像。

使用OWASP的ASVS和SAFECode的安全故事作为资源来帮助编写故事，并为安全故事撰写满意的条件。

如果团队正在为用户角色建模，请帮助他们创建反面角色，以便在填写要求和测试条件时牢记对手。

在编写需求（包括安全性要求）时，请考虑操作和基础结构，而不仅仅是功能需求。